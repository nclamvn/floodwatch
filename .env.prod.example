# =========================================================================
# FloodWatch - Production Environment Configuration
# =========================================================================
#
# SETUP INSTRUCTIONS:
# 1. Copy this file: cp .env.prod.example .env.prod
# 2. Generate secrets: openssl rand -hex 32
# 3. Replace all REPLACE_* and CHANGE_ME_* placeholders
# 4. Set file permissions: chmod 600 .env.prod
# 5. NEVER commit .env.prod to git!
#
# =========================================================================

# ========= CORE =========
ENVIRONMENT=production

# Admin token (64 hex characters) - Used for /ops, /metrics endpoints
# Generate: openssl rand -hex 32
ADMIN_TOKEN=REPLACE_WITH_RANDOM_64_HEX

# Secret key for session encryption/JWT (if used)
# Generate: openssl rand -hex 32
SECRET_KEY=REPLACE_WITH_RANDOM_64_HEX

# ========= DATABASE =========
# PostgreSQL database name
POSTGRES_DB=floodwatch

# PostgreSQL user
POSTGRES_USER=fw_prod_user

# PostgreSQL password (strong password)
# Generate: openssl rand -base64 24
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD

# PostgreSQL port (default 5432)
DB_PORT=5432

# Full PostgreSQL connection string
# Format: postgresql+psycopg://user:password@host:port/database
# Host is 'db' (Docker service name) when running in Docker Compose
DATABASE_URL=postgresql+psycopg://fw_prod_user:CHANGE_ME_STRONG_PASSWORD@db:5432/floodwatch

# Database connection pool settings
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10

# ========= API (Backend) =========
# API host (0.0.0.0 for Docker, allows external connections)
API_HOST=0.0.0.0

# API port (internal Docker port)
API_PORT=8000

# Public API base URL (used by frontend)
API_BASE_URL=https://api.floodwatch.vn

# CORS: Allowed origins (comma-separated, NO wildcards in production)
# Must match your actual domains
CORS_ORIGINS=https://floodwatch.vn,https://api.floodwatch.vn

# Number of Uvicorn/Gunicorn workers (2 workers for 2 vCPU)
WORKERS=2

# ========= WEB (Frontend - Next.js) =========
# Web port (internal Docker port)
WEB_PORT=3000

# Node environment
NODE_ENV=production

# API URL for client-side requests
NEXT_PUBLIC_API_URL=https://api.floodwatch.vn

# ========= MAP PROVIDER =========
# Choose map provider: 'mapbox' or 'goong'
# For Vietnam deployment, consider using 'goong' for better local data
NEXT_PUBLIC_MAP_PROVIDER=mapbox

# Mapbox token for map tiles (public token)
# Get from: https://account.mapbox.com/access-tokens/
NEXT_PUBLIC_MAPBOX_TOKEN=pk.your_production_mapbox_token_here

# Goong Maps API key (Vietnam-optimized)
# Get from: https://goong.io (requires 24h approval)
# Better Vietnamese address data, ngõ/hẻm mapping
NEXT_PUBLIC_GOONG_API_KEY=

# Cloudinary cloud name (public, same as backend)
NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=your_cloud_name

# Cloudinary upload preset (optional, for unsigned uploads)
# Create at: Cloudinary Console > Settings > Upload > Upload presets
NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET=your_signed_preset

# ========= CLOUDINARY (Backend) =========
# Cloud name
CLOUDINARY_CLOUD_NAME=your_cloud_name

# API credentials (get from Cloudinary dashboard)
# Get from: https://console.cloudinary.com/console/
CLOUDINARY_API_KEY=REPLACE_CLOUDINARY_API_KEY
CLOUDINARY_API_SECRET=REPLACE_CLOUDINARY_API_SECRET

# ========= ALERTS & NOTIFICATIONS =========
# Telegram bot token (optional - for alert notifications)
# Get from: @BotFather on Telegram
# Format: 123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
# Leave empty if not using Telegram alerts
TELEGRAM_BOT_TOKEN=

# Webhook HMAC secret for validating incoming webhooks (32+ characters)
# Generate: openssl rand -hex 32
WEBHOOK_SECRET=

# ========= SSL/TLS (Let's Encrypt) =========
# Primary domain
DOMAIN=floodwatch.vn

# Email for Let's Encrypt certificate notifications
CERT_EMAIL=ops@floodwatch.vn

# ========= SECURITY =========
# Content Security Policy (optional - recommended to configure in nginx instead)
# Leave empty if using infra/nginx/conf.d/security_headers.conf
CSP_POLICY=

# Enable PII scrubbing for public endpoints (phone numbers, emails)
# Set to "false" only for testing/debugging
PII_SCRUB_ENABLED=true

# ========= PERFORMANCE & RATE LIMITING =========
# Requests per minute per IP (API endpoints)
RATE_LIMIT_PER_MINUTE=60

# Burst limit for rate limiting
RATE_LIMIT_BURST=20

# ========= LOGGING =========
# Log level: DEBUG | INFO | WARNING | ERROR | CRITICAL
# Use INFO for production, DEBUG for troubleshooting
LOG_LEVEL=INFO

# Log format: json | text
LOG_FORMAT=json

# ========= EXTERNAL APIs (Optional) =========
# KTTV (Vietnam Meteorological Service) scraper credentials (if needed)
# Leave empty if API is public
KTTV_API_KEY=

# Roads/Transportation API credentials (if needed)
ROADS_API_KEY=

# ========= BACKUP & STORAGE (Optional) =========
# S3 compatible storage for off-site backups
# Works with: AWS S3, MinIO, DigitalOcean Spaces, Backblaze B2, etc.
BACKUP_S3_ENDPOINT=
BACKUP_S3_BUCKET=
BACKUP_S3_ACCESS_KEY=
BACKUP_S3_SECRET_KEY=

# ========= CONTACT & PUBLIC INFO =========
# Displayed in helpcard, error pages, and public API docs
PUBLIC_CONTACT_EMAIL=ops@floodwatch.vn

# ========= FEATURE FLAGS =========
# Enable daily PDF snapshots (requires WeasyPrint dependencies)
# Set to "false" if WeasyPrint not installed (will fall back to HTML)
ENABLE_PDF_SNAPSHOTS=true

# Enable Prometheus metrics endpoint (/metrics)
ENABLE_METRICS=true

# Enable API key authentication for public API
ENABLE_API_KEYS=true

# Enable Telegram alerts
ENABLE_TELEGRAM_ALERTS=false

# ========= DEVELOPMENT FLAGS (DO NOT CHANGE IN PRODUCTION) =========
# DEBUG mode - MUST be false in production
DEBUG=false

# Allow HTTP (no SSL) - MUST be false in production
ALLOW_HTTP=false

# ========= OPTIONAL: MONITORING =========
# Sentry DSN (for error tracking)
SENTRY_DSN=

# Sentry environment
SENTRY_ENVIRONMENT=production

# Sentry traces sample rate (0.0 to 1.0)
SENTRY_TRACES_SAMPLE_RATE=0.1

# ========= OPTIONAL: ANALYTICS =========
# Google Analytics tracking ID (if using)
NEXT_PUBLIC_GA_TRACKING_ID=

# =========================================================================
# VALIDATION CHECKLIST:
# =========================================================================
# [ ] ADMIN_TOKEN is 64 hex characters (generated with openssl rand -hex 32)
# [ ] SECRET_KEY is 64 hex characters
# [ ] POSTGRES_PASSWORD is strong (24+ characters)
# [ ] DATABASE_URL password matches POSTGRES_PASSWORD
# [ ] CORS_ORIGINS matches your actual domain (https://floodwatch.vn)
# [ ] NEXT_PUBLIC_MAPBOX_TOKEN starts with 'pk.' and is valid
# [ ] CLOUDINARY_* credentials are correct and tested
# [ ] WEBHOOK_SECRET is set (if using webhooks)
# [ ] PII_SCRUB_ENABLED is true
# [ ] LOG_LEVEL is INFO or WARNING (not DEBUG)
# [ ] DEBUG is false
# [ ] ALLOW_HTTP is false
# [ ] DOMAIN matches your actual domain
# [ ] CERT_EMAIL is a valid email address
# [ ] File permissions: chmod 600 .env.prod
#
# TEST CONFIGURATION:
#   # Check for unreplaced placeholders
#   grep -E "REPLACE_|CHANGE_ME_|your_production_|your_cloud_|your_signed_" .env.prod
#   (Should return empty if all placeholders replaced)
#
#   # Check security settings
#   grep -E "DEBUG=true|ALLOW_HTTP=true" .env.prod
#   (Should return empty - both must be false)
#
#   # Verify critical variables are set
#   grep -E "^ADMIN_TOKEN=.{64}" .env.prod
#   grep -E "^DATABASE_URL=postgresql" .env.prod
#   grep -E "^CORS_ORIGINS=https://" .env.prod
#
# QUICK SETUP COMMANDS:
#   # Generate all required secrets at once
#   echo "ADMIN_TOKEN=$(openssl rand -hex 32)"
#   echo "SECRET_KEY=$(openssl rand -hex 32)"
#   echo "POSTGRES_PASSWORD=$(openssl rand -base64 24)"
#   echo "WEBHOOK_SECRET=$(openssl rand -hex 32)"
#
# =========================================================================
